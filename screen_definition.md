# 営業日報システム 画面定義書 (改訂版)

## 目次

1. [画面一覧](#画面一覧)
2. [画面詳細](#画面詳細)
3. [画面遷移図](#画面遷移図)

---

## 改訂履歴

| 版  | 改訂日 | 改訂内容               |
| --- | ------ | ---------------------- |
| 1.0 | -      | 初版作成               |
| 2.0 | -      | コメント確認機能を追加 |

---

## 画面一覧

| 画面ID | 画面名                   | 対象ユーザー       | 概要                       |
| ------ | ------------------------ | ------------------ | -------------------------- |
| S01    | ログイン画面             | 全ユーザー         | システムへのログイン       |
| S02    | ホーム画面               | 全ユーザー         | ダッシュボード・メニュー   |
| S03    | 日報一覧画面             | 全ユーザー         | 日報の一覧表示             |
| S04    | 日報作成・編集画面       | 営業担当者         | 日報の新規作成・編集       |
| S05    | 日報詳細画面             | 全ユーザー         | 日報の詳細表示・コメント   |
| S06    | 顧客マスタ一覧画面       | 全ユーザー         | 顧客情報の一覧表示         |
| S07    | 顧客マスタ登録・編集画面 | 営業担当者・管理者 | 顧客情報の登録・編集       |
| S08    | 営業マスタ一覧画面       | 管理者             | 営業担当者の一覧表示       |
| S09    | 営業マスタ登録・編集画面 | 管理者             | 営業担当者情報の登録・編集 |

---

## 画面詳細

### S01: ログイン画面

#### 画面概要

ユーザーがシステムにログインするための画面

#### 画面項目

| 項目名         | 入力形式   | 必須 | 備考                   |
| -------------- | ---------- | ---- | ---------------------- |
| 営業コード     | テキスト   | ○    | 半角英数字             |
| パスワード     | パスワード | ○    | マスク表示             |
| ログインボタン | ボタン     | -    | クリックでログイン処理 |

#### 画面動作

- ログインボタン押下時、認証処理を実行
- 認証成功時: ホーム画面(S02)へ遷移
- 認証失敗時: エラーメッセージ表示

#### エラーメッセージ

- 「営業コードまたはパスワードが正しくありません」

---

### S02: ホーム画面

#### 画面概要

ログイン後の初期画面。当日の日報状況やメニューを表示

#### 表示内容

**サマリー情報**

- ログインユーザー名
- 当日の日報作成状況
  - 未作成の場合: 「本日の日報が未作成です」+ 作成ボタン
  - 作成済みの場合: 「本日の日報: 提出済み」+ 編集ボタン
- **未確認コメント通知（営業担当者のみ）**
  - 未確認コメントがある場合: 「未確認のコメントが X 件あります」+ 確認ボタン
  - 未確認コメントがない場合: 表示なし
  - 確認ボタン押下: 未確認コメントがある日報の一覧へ遷移（S03にフィルタ適用）

**メインメニュー**

- 日報を作成する
- 日報一覧を見る
- 顧客マスタ
- 営業マスタ（管理者のみ表示）

#### 画面動作

- 各メニューをクリックで対応画面へ遷移
- 未確認コメント数は、ログインユーザーの日報に対する未読コメントの総数を表示

---

### S03: 日報一覧画面

#### 画面概要

日報の一覧を表示し、検索・絞り込みが可能

#### 検索条件

| 項目名             | 入力形式         | 備考                                     |
| ------------------ | ---------------- | ---------------------------------------- |
| 対象期間（開始）   | 日付             | デフォルト: 当月1日                      |
| 対象期間（終了）   | 日付             | デフォルト: 当日                         |
| 営業担当者         | プルダウン       | 管理者は全員表示可、営業は自分のみ       |
| ステータス         | プルダウン       | 全て/下書き/提出済み/コメント済み        |
| **未確認コメント** | チェックボックス | **ONで未確認コメントがある日報のみ表示** |
| 検索ボタン         | ボタン           | -                                        |

#### 一覧表示項目

| 項目名     | 表示内容                                                          |
| ---------- | ----------------------------------------------------------------- |
| 日報日付   | YYYY/MM/DD形式                                                    |
| 営業担当者 | 営業担当者名                                                      |
| 訪問件数   | 当日の訪問記録件数                                                |
| ステータス | 下書き/提出済み/コメント済み                                      |
| コメント   | コメントがある場合アイコン表示                                    |
| **未確認** | **未確認コメントがある場合、バッジで件数表示（例: 「NEW 2件」）** |
| 操作       | 詳細ボタン、編集ボタン（自分の日報のみ）                          |

#### 画面動作

- 一覧は日付降順で表示（最新が上）
- 詳細ボタン押下: 日報詳細画面(S05)へ遷移
- 編集ボタン押下: 日報作成・編集画面(S04)へ遷移
- ページング機能: 20件/ページ
- **ホーム画面から「未確認コメント確認」で遷移した場合、未確認コメントチェックボックスがONの状態で表示**

---

### S04: 日報作成・編集画面

#### 画面概要

営業担当者が日報を作成・編集する画面

#### 基本情報

| 項目名     | 入力形式 | 必須 | 備考                       |
| ---------- | -------- | ---- | -------------------------- |
| 日報日付   | 日付     | ○    | 新規作成時はデフォルト当日 |
| 営業担当者 | 表示のみ | -    | ログインユーザー           |

#### 訪問記録セクション

**訪問記録リスト**（複数行入力可能）

| 項目名     | 入力形式       | 必須 | 備考               |
| ---------- | -------------- | ---- | ------------------ |
| 顧客       | プルダウン     | ○    | 顧客マスタから選択 |
| 訪問日時   | 日時           | ○    | YYYY/MM/DD HH:MM   |
| 訪問内容   | テキストエリア | ○    | 最大500文字        |
| 訪問結果   | テキストエリア | -    | 最大500文字        |
| 削除ボタン | ボタン         | -    | その行を削除       |

**操作ボタン**

- 訪問記録を追加: 新しい訪問記録行を追加

#### Problem（課題・相談）セクション

| 項目名     | 入力形式       | 必須 | 備考         |
| ---------- | -------------- | ---- | ------------ |
| 課題・相談 | テキストエリア | -    | 最大1000文字 |

#### Plan（明日の予定）セクション

| 項目名     | 入力形式       | 必須 | 備考         |
| ---------- | -------------- | ---- | ------------ |
| 明日の予定 | テキストエリア | -    | 最大1000文字 |

#### フッターボタン

- 下書き保存: ステータス「下書き」で保存
- 提出: ステータス「提出済み」で保存
- キャンセル: 日報一覧画面(S03)へ戻る

#### 画面動作

- 訪問記録を追加ボタン押下: 新しい入力行を追加（最大10行まで）
- 削除ボタン押下: 確認ダイアログ表示後、その行を削除
- 下書き保存: バリデーションなしで保存、一覧画面へ遷移
- 提出: 必須項目チェック後、保存、一覧画面へ遷移

#### バリデーション

- 訪問記録が1件以上必要
- 各訪問記録の必須項目（顧客、訪問日時、訪問内容）入力チェック

---

### S05: 日報詳細画面

#### 画面概要

日報の詳細を表示し、上長がコメントを追加できる画面。営業担当者はコメントを確認済みにできる。

#### 表示内容

**基本情報**

- 日報日付
- 営業担当者名
- ステータス
- 提出日時

**訪問記録リスト**

| 項目     | 表示内容             |
| -------- | -------------------- |
| No.      | 連番                 |
| 顧客名   | 顧客マスタの顧客名   |
| 訪問日時 | YYYY/MM/DD HH:MM形式 |
| 訪問内容 | 入力された訪問内容   |
| 訪問結果 | 入力された訪問結果   |

**Problem（課題・相談）**

- 入力内容を表示
- **コメント一覧**
  - 各コメントの表示項目:
    - コメント日時（YYYY/MM/DD HH:MM）
    - コメント者名
    - コメント内容
    - **既読ステータス表示**（営業担当者が閲覧時のみ）
      - 未読の場合: 「未確認」バッジ + 「確認済みにする」ボタン
      - 既読の場合: 「確認済み（YYYY/MM/DD HH:MM）」グレー表示
    - **「確認済みにする」ボタン**（営業担当者かつ未読コメントのみ表示）
- コメント入力欄（管理者のみ表示）
  - テキストエリア（最大500文字）
  - コメント追加ボタン

**Plan（明日の予定）**

- 入力内容を表示
- **コメント一覧**（Problemと同様の表示・操作）
- コメント入力欄（管理者のみ表示）
  - テキストエリア（最大500文字）
  - コメント追加ボタン

#### フッターボタン

- 編集（作成者本人のみ表示）: 日報作成・編集画面(S04)へ遷移
- 戻る: 日報一覧画面(S03)へ遷移

#### 画面動作

- **コメント追加ボタン押下（管理者）**:
  - コメントを保存（is_read=false）
  - 画面をリフレッシュ
  - 日報のステータスを「コメント済み」に更新
- **「確認済みにする」ボタン押下（営業担当者）**:
  - 該当コメントのis_readをtrueに更新
  - read_atに現在日時を設定
  - 画面をリフレッシュ（ボタンが消え、「確認済み」表示に変わる）
- コメントは追加日時降順で表示（最新が上）
- 未読コメントは背景色を薄い黄色などで強調表示

#### 表示例

```
【Problem（課題・相談）】
今月の売上目標達成が厳しい状況です。追加施策について相談したいです。

【コメント】
┌─────────────────────────────────┐
│ 2026/01/10 15:30  山田 太郎（上長）        │
│ [未確認]                    [確認済みにする] │
│                                            │
│ 来週、追加商談の機会を設定しましょう。      │
│ 明日のミーティングで詳細を話しましょう。    │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│ 2026/01/09 18:00  山田 太郎（上長）        │
│ 確認済み（2026/01/09 19:30）              │
│                                            │
│ 状況は把握しました。対策を一緒に考えましょう。│
└─────────────────────────────────┘
```

---

### S06: 顧客マスタ一覧画面

#### 画面概要

顧客情報の一覧を表示し、検索が可能

#### 検索条件

| 項目名     | 入力形式   | 備考            |
| ---------- | ---------- | --------------- |
| 顧客名     | テキスト   | 部分一致        |
| 顧客コード | テキスト   | 部分一致        |
| 担当営業   | プルダウン | 全員/特定の営業 |
| 検索ボタン | ボタン     | -               |

#### 一覧表示項目

| 項目名     | 表示内容               |
| ---------- | ---------------------- |
| 顧客コード | 顧客コード             |
| 顧客名     | 顧客名                 |
| 業種       | 業種                   |
| 担当営業   | 営業担当者名           |
| 電話番号   | 電話番号               |
| 操作       | 詳細ボタン、編集ボタン |

#### ヘッダーボタン

- 新規登録: 顧客マスタ登録・編集画面(S07)へ遷移（新規モード）

#### 画面動作

- 詳細・編集ボタン押下: 顧客マスタ登録・編集画面(S07)へ遷移（詳細/編集モード）
- ページング機能: 20件/ページ

---

### S07: 顧客マスタ登録・編集画面

#### 画面概要

顧客情報を登録・編集する画面

#### 入力項目

| 項目名     | 入力形式       | 必須 | 備考                          |
| ---------- | -------------- | ---- | ----------------------------- |
| 顧客コード | テキスト       | ○    | 半角英数字、ユニーク          |
| 顧客名     | テキスト       | ○    | 最大100文字                   |
| 業種       | プルダウン     | -    | 製造業/IT/サービス/その他など |
| 郵便番号   | テキスト       | -    | 半角数字、ハイフンあり        |
| 住所       | テキスト       | -    | 最大200文字                   |
| 電話番号   | テキスト       | -    | 半角数字、ハイフン可          |
| 担当営業   | プルダウン     | ○    | 営業マスタから選択            |
| 備考       | テキストエリア | -    | 最大500文字                   |

#### フッターボタン

- 保存: 入力内容を保存し、一覧画面(S06)へ遷移
- キャンセル: 一覧画面(S06)へ戻る
- 削除（編集モードのみ）: 確認後削除し、一覧画面へ遷移

#### 画面動作

- 新規登録モード: 全項目入力可能
- 編集モード: 顧客コードは変更不可
- 保存ボタン押下: バリデーション実行後、保存
- 削除ボタン押下: 「本当に削除しますか？」確認ダイアログ表示

#### バリデーション

- 必須項目チェック
- 顧客コード重複チェック（新規登録時）
- 形式チェック（電話番号、郵便番号）

---

### S08: 営業マスタ一覧画面

#### 画面概要

営業担当者情報の一覧を表示（管理者のみアクセス可能）

#### 検索条件

| 項目名       | 入力形式   | 備考                     |
| ------------ | ---------- | ------------------------ |
| 営業担当者名 | テキスト   | 部分一致                 |
| 営業コード   | テキスト   | 部分一致                 |
| 所属部署     | プルダウン | 全て/営業1課/営業2課など |
| 検索ボタン   | ボタン     | -                        |

#### 一覧表示項目

| 項目名       | 表示内容               |
| ------------ | ---------------------- |
| 営業コード   | 営業コード             |
| 営業担当者名 | 営業担当者名           |
| 所属部署     | 所属部署               |
| 上長         | 上長の営業担当者名     |
| 管理者       | 管理者フラグ（○/－）   |
| 操作         | 詳細ボタン、編集ボタン |

#### ヘッダーボタン

- 新規登録: 営業マスタ登録・編集画面(S09)へ遷移（新規モード）

#### 画面動作

- 詳細・編集ボタン押下: 営業マスタ登録・編集画面(S09)へ遷移（詳細/編集モード）
- ページング機能: 20件/ページ

---

### S09: 営業マスタ登録・編集画面

#### 画面概要

営業担当者情報を登録・編集する画面（管理者のみアクセス可能）

#### 入力項目

| 項目名         | 入力形式         | 必須 | 備考                                          |
| -------------- | ---------------- | ---- | --------------------------------------------- |
| 営業コード     | テキスト         | ○    | 半角英数字、ユニーク                          |
| 営業担当者名   | テキスト         | ○    | 最大100文字                                   |
| メールアドレス | テキスト         | ○    | メール形式                                    |
| パスワード     | パスワード       | ○※   | ※新規登録時のみ必須、編集時は変更する場合のみ |
| パスワード確認 | パスワード       | ○※   | パスワード入力時のみ                          |
| 所属部署       | プルダウン       | ○    | 営業1課/営業2課など                           |
| 上長           | プルダウン       | -    | 営業マスタから選択                            |
| 管理者権限     | チェックボックス | -    | ONで管理者権限付与                            |

#### フッターボタン

- 保存: 入力内容を保存し、一覧画面(S08)へ遷移
- キャンセル: 一覧画面(S08)へ戻る
- 削除（編集モードのみ）: 確認後削除し、一覧画面へ遷移

#### 画面動作

- 新規登録モード: 全項目入力可能
- 編集モード: 営業コードは変更不可、パスワードは変更時のみ入力
- 保存ボタン押下: バリデーション実行後、保存
- 削除ボタン押下: 「本当に削除しますか？」確認ダイアログ表示

#### バリデーション

- 必須項目チェック
- 営業コード重複チェック（新規登録時）
- メールアドレス形式チェック
- パスワードと確認用パスワードの一致チェック
- パスワード強度チェック（8文字以上、英数字混在）

---

## 画面遷移図

```
[S01: ログイン画面]
    ↓ ログイン成功
[S02: ホーム画面]
    ├→ 日報作成 → [S04: 日報作成・編集画面] ⇄ [S03: 日報一覧画面]
    │                                              ↓
    ├→ 日報一覧 → [S03: 日報一覧画面] → [S05: 日報詳細画面]
    │                                      ↓ 確認済みにする
    ├→ 未確認コメント確認 → [S03: 日報一覧画面（未確認フィルタON）]
    │
    ├→ 顧客マスタ → [S06: 顧客マスタ一覧画面] ⇄ [S07: 顧客マスタ登録・編集画面]
    │
    └→ 営業マスタ（管理者のみ）
         └→ [S08: 営業マスタ一覧画面] ⇄ [S09: 営業マスタ登録・編集画面]
```

---

## 共通仕様

### レイアウト

- ヘッダー: システム名、ログインユーザー名、**未確認コメント数（営業担当者のみ）**、ログアウトボタン
- サイドメニュー: 主要機能へのリンク
- メインコンテンツ: 各画面の内容
- フッター: コピーライト

### レスポンシブ対応

- PC、タブレット、スマートフォンに対応
- スマートフォン表示時はサイドメニューをハンバーガーメニュー化

### エラーハンドリング

- 入力エラー: 該当項目の近くに赤字でエラーメッセージ表示
- システムエラー: エラーダイアログ表示後、適切な画面へ遷移

### セッション管理

- 30分間操作がない場合、自動ログアウト
- ログアウト時はログイン画面(S01)へ遷移

### 通知機能

- **ヘッダーの未確認コメント数は常に最新の状態を反映**
- 未確認コメントがある場合、数字を赤色などで強調表示
- 未確認コメント数をクリックすると、未確認コメントがある日報一覧へ遷移

---

## コメント確認機能の詳細仕様

### 既読管理の対象

- 上長（管理者）が追加したコメントのみが既読管理の対象
- 自分自身が追加したコメントは既読管理の対象外

### 既読のタイミング

- 営業担当者が日報詳細画面(S05)で各コメントの「確認済みにする」ボタンを押下した時点
- **画面を開いただけでは既読にならない（明示的なアクションが必要）**

### 未確認コメント数のカウント

- ログインユーザー（営業担当者）の全日報に対する未読コメントの総数
- リアルタイムに更新（他の画面から戻った際も最新の数値を表示）

### 表示の優先順位

- 日報一覧画面: 未確認コメントがある日報を上位に表示するオプションも検討可能
- 日報詳細画面: 未読コメントを上に表示（既読コメントの上）
